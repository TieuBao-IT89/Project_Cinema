@model Project_Cinema.ViewModels.ForgotPasswordViewModel

@{
    ViewData["Title"] = "Quên mật khẩu";
    var sent = TempData["ForgotPasswordSent"] as bool? ?? false;
    var cooldown = 0;
    if (ViewData["CooldownSeconds"] is int seconds)
    {
        cooldown = seconds;
    }
    else if (ViewData["CooldownSeconds"] is string s && int.TryParse(s, out var parsed))
    {
        cooldown = parsed;
    }
}

@section Styles {
    <link rel="stylesheet" href="~/css/login.css" />
    <link rel="stylesheet" href="~/css/forgot-password.css" />
}

<section class="login-section forgot-password-section">
    <div class="forgot-password-container">
        <div class="forgot-password-form-wrapper">
            <div class="form-decorations">
                <div class="decoration-circle decoration-1"></div>
                <div class="decoration-circle decoration-2"></div>
                <div class="decoration-circle decoration-3"></div>
            </div>

            <div class="form-wrapper">
                <div class="login-card">
                    <div class="login-card-header">
                        <div class="login-icon-wrapper">
                            <div class="icon-inner">
                                <i class="fas fa-key"></i>
                            </div>
                            <div class="icon-glow"></div>
                        </div>
                        <h2 class="login-card-title">
                            <span class="title-text">Quên mật khẩu</span>
                        </h2>
                        <p class="login-card-subtitle">Nhập email hoặc số điện thoại để nhận liên kết khôi phục</p>
                    </div>

                    @if (sent)
                    {
                        <div class="alert-message success" style="display:flex;">
                            <i class="alert-icon fas fa-check-circle"></i>
                            <span class="alert-text">Nếu tài khoản tồn tại, chúng tôi đã gửi email khôi phục. Vui lòng kiểm tra hộp thư (kể cả spam).</span>
                        </div>
                    }

                    @if (!ViewData.ModelState.IsValid)
                    {
                        <div class="alert-message error" style="display:flex;">
                            <i class="alert-icon fas fa-exclamation-circle"></i>
                            <span class="alert-text">
                                @Html.ValidationSummary(false, "", new { @class = "validation-summary" })
                            </span>
                        </div>
                    }

                    <form id="forgotPasswordForm" class="login-form" asp-controller="Account" asp-action="ForgotPassword" method="post" data-server-forgot="true">
                        @Html.AntiForgeryToken()

                        <div class="form-group-login floating-label-group">
                            <div class="input-wrapper-modern">
                                <i class="input-icon-left fas fa-envelope"></i>
                                <input asp-for="Identifier"
                                       type="text"
                                       id="forgotPasswordIdentifier"
                                       class="form-input-modern"
                                       placeholder=" "
                                       autocomplete="username"
                                       required />
                                <label for="forgotPasswordIdentifier" class="floating-label">
                                    Email hoặc số điện thoại
                                </label>
                                <div class="input-icon-right">
                                    <i class="fas fa-check-circle input-success-icon" style="display: none;"></i>
                                    <i class="fas fa-exclamation-circle input-error-icon" style="display: none;"></i>
                                </div>
                            </div>
                            <span class="error-message" id="identifierError" asp-validation-for="Identifier"></span>
                        </div>

                        <button type="submit" class="btn-login-submit" id="forgotPasswordSubmitBtn" data-cooldown="@cooldown">
                            <span class="btn-text">
                                <i class="fas fa-paper-plane"></i> Gửi yêu cầu khôi phục
                            </span>
                            <span class="btn-loader" style="display: none;">
                                <i class="fas fa-spinner fa-spin"></i> Đang xử lý...
                            </span>
                        </button>
                    </form>

                    @if (sent)
                    {
                        <div class="additional-navigation" style="margin-top: 14px;">
                            <button type="submit" form="forgotPasswordForm" class="nav-link" style="background:transparent;border:none;cursor:pointer;">
                                <i class="fas fa-redo"></i> Gửi lại email reset
                                <span id="resendCountdown" style="margin-left:8px;opacity:.8;"></span>
                            </button>
                        </div>
                    }

                    <div class="additional-navigation">
                        <a asp-controller="Account" asp-action="Login" class="nav-link">
                            <i class="fas fa-arrow-left"></i> Quay lại đăng nhập
                        </a>
                        <span class="nav-separator">|</span>
                        <a asp-controller="Account" asp-action="Register" class="nav-link">
                            <i class="fas fa-user-plus"></i> Đăng ký tài khoản mới
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script src="~/js/forgot-password.js"></script>
}

